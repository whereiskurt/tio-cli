package tio

import (
	"fmt"

	"github.com/spf13/cobra"
	"github.com/whereiskurt/tio-cli/internal/app/tio/vulnerability"
	"github.com/whereiskurt/tio-cli/internal/pkg/tio/ui"
)

//Cobra sub-command
var pluginCmd = &cobra.Command{
	Aliases: []string{"plugin","plugins"},
	Use:     "plugin",
	PreRun:  MainVulnCmd.PreRun,
	Run:     mainPlugin,
}

func init() {
	MainVulnCmd.AddCommand(pluginCmd)

	pluginCmd.SetHelpFunc(helpOutputPlugin)
	pluginCmd.SetUsageFunc(usageOutputPlugin)

	return
}

func helpOutputPlugin(cmd *cobra.Command, args []string) {
	printPluginHelp()
	return
}
func usageOutputPlugin(cmd *cobra.Command) error {
	printPluginHelp()
	return nil
}

func printPluginHelp() {
	fmt.Println(fmt.Sprintf(`
Plugins
----------------------------->
  `))
	return
}

func mainPlugin(cmd *cobra.Command, args []string) {

	configSuccess := VulnConfig.Base.IsSuccessState
	if !configSuccess {
		cli := ui.NewCommandLineInterface(VulnConfig)
		configSuccess := cli.PromptForConfigKeys()
		if !configSuccess {
			return
		}
	}

	c := vulnerability.NewPlugin(VulnConfig)

	c.Execute()
	return
}
